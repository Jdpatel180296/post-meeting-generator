# üîê LinkedIn & Facebook OAuth Setup Guide

## Status: ‚úÖ OAuth Endpoints Implemented

The backend now has full OAuth support for LinkedIn and Facebook. You just need to configure your credentials!

---

## üìã Implementation Summary

### What's Been Built

‚úÖ **LinkedIn OAuth Flow**

- Endpoint: `GET /api/auth/linkedin` - Initiates OAuth
- Endpoint: `GET /api/auth/linkedin/callback` - Handles callback
- Saves access token to database
- State validation for security

‚úÖ **Facebook OAuth Flow**

- Endpoint: `GET /api/auth/facebook` - Initiates OAuth
- Endpoint: `GET /api/auth/facebook/callback` - Handles callback
- Saves access token to database
- State validation for security

‚úÖ **Frontend Integration**

- SettingsPage buttons now trigger real OAuth flows
- Connect button redirects to OAuth provider
- Disconnect button removes credentials from database
- Success/error messages displayed to user

‚úÖ **Database Integration**

- Credentials stored in `social_media_accounts` table
- User ID linked to credentials
- Platform and access tokens secured

---

## üöÄ Setup Instructions

### Step 1: Get LinkedIn OAuth Credentials

1. Go to https://www.linkedin.com/developers/apps
2. Click "Create app"
3. Fill in app details:
   - **App name:** Post-Meeting Generator
   - **LinkedIn Page:** Select or create a page
   - **App logo:** Upload a logo
   - **Legal agreement:** Accept
4. In "Auth" tab, under "Redirect URLs":
   - Add: `http://localhost:4000/api/auth/linkedin/callback`
5. Copy your credentials:
   - **Client ID** ‚Üí Copy to LINKEDIN_CLIENT_ID
   - **Client Secret** ‚Üí Copy to LINKEDIN_CLIENT_SECRET

### Step 2: Get Facebook OAuth Credentials

1. Go to https://developers.facebook.com/apps
2. Click "Create App"
3. Choose "Consumer"
4. Fill in app details:
   - **App name:** Post-Meeting Generator
   - **App contact email:** your@email.com
   - **App purpose:** Manage Business
5. Add "Facebook Login" product
6. In Settings ‚Üí Basic:
   - **App ID** ‚Üí Copy to FACEBOOK_APP_ID
   - **App Secret** ‚Üí Copy to FACEBOOK_APP_SECRET
7. In Facebook Login ‚Üí Settings:
   - Add Valid Redirect URIs: `http://localhost:4000/api/auth/facebook/callback`

### Step 3: Update Environment Variables

Edit `/server/.env`:

```properties
# LinkedIn OAuth
LINKEDIN_CLIENT_ID=your_actual_client_id_here
LINKEDIN_CLIENT_SECRET=your_actual_client_secret_here
LINKEDIN_REDIRECT_URI=http://localhost:4000/api/auth/linkedin/callback

# Facebook OAuth
FACEBOOK_APP_ID=your_actual_app_id_here
FACEBOOK_APP_SECRET=your_actual_app_secret_here
FACEBOOK_REDIRECT_URI=http://localhost:4000/api/auth/facebook/callback
```

### Step 4: Restart Server

```bash
# Kill existing server (Ctrl+C)
# Restart:
cd server && node index.js
```

### Step 5: Test OAuth Flow

1. Open http://localhost:3000
2. Navigate to Settings page
3. Click "Connect" under LinkedIn
4. You should be redirected to LinkedIn login
5. After login, you should be redirected back and see "LinkedIn connected!"
6. Repeat for Facebook

---

## üîó API Endpoints

### Connect to LinkedIn

```
GET /api/auth/linkedin
Response: { "url": "https://www.linkedin.com/oauth/v2/authorization?..." }
```

### LinkedIn OAuth Callback

```
GET /api/auth/linkedin/callback?code=...&state=...
Redirects to: http://localhost:3000/settings?success=LinkedIn%20connected
```

### Connect to Facebook

```
GET /api/auth/facebook
Response: { "url": "https://www.facebook.com/v18.0/dialog/oauth?..." }
```

### Facebook OAuth Callback

```
GET /api/auth/facebook/callback?code=...&state=...
Redirects to: http://localhost:3000/settings?success=Facebook%20connected
```

### Disconnect Account

```
DELETE /api/social-accounts/{platform}
Platform: "linkedin" or "facebook"
Response: { "ok": true, "message": "linkedin account disconnected" }
```

---

## üíæ Database Schema

Connected accounts are stored in `social_media_accounts` table:

```sql
CREATE TABLE social_media_accounts (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  platform VARCHAR(50),           -- 'linkedin' or 'facebook'
  access_token TEXT,              -- OAuth access token
  refresh_token TEXT,             -- OAuth refresh token (if available)
  platform_user_id VARCHAR(255),  -- LinkedIn/Facebook user ID
  expires_at TIMESTAMP,           -- Token expiration (if available)
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## üîë Scopes & Permissions

### LinkedIn Scopes

- `w_member_social` - Write permission to post content

### Facebook Scopes

- `pages_manage_posts` - Post to pages you manage
- `pages_manage_metadata` - Manage page metadata
- `pages_read_engagement` - Read page engagement

---

## üß™ Testing Checklist

- [ ] Server running with valid OAuth credentials
- [ ] Client running on localhost:3000
- [ ] Can click LinkedIn "Connect" button
- [ ] Redirected to LinkedIn login page
- [ ] After login, redirected back to settings
- [ ] Success message appears
- [ ] LinkedIn account shows as "Connected"
- [ ] Can click "Disconnect" button
- [ ] Confirmation dialog appears
- [ ] Account disconnected successfully
- [ ] Same flow works for Facebook

---

## üö® Troubleshooting

### "Invalid client credentials"

- Check LINKEDIN_CLIENT_ID and LINKEDIN_CLIENT_SECRET are correct
- Verify they haven't been regenerated in LinkedIn admin panel
- Check for extra spaces in .env file

### "Redirect URI mismatch"

- Verify redirect URL exactly matches in OAuth provider settings
- Ensure http:// not https:// for localhost
- Check port 4000 is correct

### "State mismatch"

- Server creates random state and verifies it
- If this fails, it's likely a server issue
- Check browser console for any errors

### "No accounts showing"

- Verify social_media_accounts table exists in database
- Check database has proper user_id reference
- Try connecting again

### "Connection successful but account not in list"

- Refresh the settings page
- Check browser DevTools network tab for /api/social-accounts response
- Verify database query returns results

---

## üîÑ Next Steps

After OAuth is set up, you can implement actual posting:

### LinkedIn Posting

```javascript
POST https://api.linkedin.com/v2/ugcPosts
Authorization: Bearer {access_token}
Body: { content, ...ugc_post_payload }
```

### Facebook Posting

```javascript
POST https://graph.facebook.com/v18.0/{page_id}/feed
Query: access_token={token}, message={content}
```

See `.OAUTH_IMPLEMENTATION_NEXT.md` for details.

---

## üìö References

- [LinkedIn OAuth 2.0](https://learn.microsoft.com/en-us/linkedin/shared/authentication/authentication)
- [Facebook Login API](https://developers.facebook.com/docs/facebook-login)
- [LinkedIn Share on LinkedIn](https://learn.microsoft.com/en-us/linkedin/consumer/integrations/self-served/share-on-linkedin)
- [Facebook Graph API](https://developers.facebook.com/docs/graph-api)

---

## ‚úÖ Implementation Complete

All OAuth infrastructure is now in place. Follow the setup steps above to configure your credentials, then test the connections!

Once working, you can proceed to implement the actual posting logic to LinkedIn and Facebook from the MeetingDetailPage.
